## MEMMALLOC TEST

##### 1. 介绍

此文档是memmalloc的功能测试文档，测试代码在/test目录下

##### 2.基本功能测试

测试代码路径：/test/function_test.c

测试命令：make run_function_test

| 测试函数名          | 测试介绍                                   | 测试结果 |
| ------------------- | ------------------------------------------ | -------- |
| small_malloc_test   | 每个小内存块存储链表是否能分配释放小内存块 | ☑️        |
| large_malloc_test   | 每个大内存块存储链表是否能分配释放大内存块 | ☑️        |
| l_large_malloc_test | 是否能分配释放超大内存块                   | ☑️        |
| calloc_test         | 测试calloc函数是否能正确执行               | ☑️        |
| realloc_test        | 测试realloc函数是否能正确执行              | ☑️        |

##### 3.单线程测试

测试代码路径：/test/function_test.c

测试命令:make run_function_test

| 测试函数名          | 测试介绍                                                     | 测试结果 |
| ------------------- | ------------------------------------------------------------ | -------- |
| single_thread_test1 | 每次分配256B大小内存块，连续分配10万次，分配后立刻释放，重复10次，是否能正确执行 | ☑️        |
| single_thread_test2 | 每次分配256B大小内存块，连续分配10万次，然后释放，重复10次，是否能正确执行 | ☑️        |
| single_thread_test3 | 每次分配256B大小内存块，连续分配10万次，分配后随机释放，重复10次，是否能正确执行 | ☑️        |
| single_thread_test4 | 分配随机大小内存块，连续分配10万次，分配后立刻释放，重复10次，是否能正确执行 | ☑️        |
| single_thread_test5 | 分配随机大小内存块，连续分配10万次，然后释放，重复10次，是否能正确执行 | ☑️        |
| single_thread_test6 | 分配随机大小内存块，连续分配10万次，分配后随机释放，重复10次，是否能正确执行 | ☑️        |

##### 4.多线程测试

测试代码路径：/test/function_test.c

测试命令：make run_function_test

| 测试函数名         | 测试介绍                                                     | 测试结果 |
| ------------------ | ------------------------------------------------------------ | -------- |
| multi_thread_test1 | 10个线程，每次分配256B大小内存块，连续分配10万次，分配后立刻释放，是否能正确执行 | ☑️        |
| multi_thread_test2 | 10个线程，每次分配256B大小内存块，连续分配10万次，然后释放，是否能正确执行 | ☑️        |
| multi_thread_test3 | 10个线程，每次分配256B大小内存块，连续分配10万次，分配后随机释放，是否能正确执行 | ☑️        |
| multi_thread_test4 | 10个线程，分配随机大小内存块，连续分配10万次，分配后立刻释放，是否能正确执行 | ☑️        |
| multi_thread_test5 | 10个线程，分配随机大小内存块，连续分配10万次，然后释放，是否能正确执行 | ☑️        |
| multi_thread_test6 | 10个线程，分配随机大小内存块，连续分配10万次，分配后随机释放，是否能正确执行 | ☑️        |

##### 5.抗单粒子翻转功能

##### 5.1奇偶校验码

测试代码路径：/test/seu_test.c

测试命令：make run_seu_test

| 测试函数名             | 测试介绍                                                     | 测试结果 |
| ---------------------- | ------------------------------------------------------------ | -------- |
| seu_test               | 测试抗单粒子翻转功能能否正确执行                             | ☑️        |
| single_thread_seu_test | 单线程下，分配内存后发生单粒子翻转后再读取数据，然后随机释放，重复10万次，发生单粒子翻转后是否能读取正确数据 | ☑️        |
| multi_thread_seu_test  | 10个线程线程，分配内存后发生单粒子翻转后再读取数据，然后随机释放，重复10万次，发生单粒子翻转后是否能读取正确数据 | ☑️        |

##### 5.2三模冗余

测试代码路径：/test/tmr_test.c

测试命令：make run_tmr_test

| 测试函数名             | 测试介绍                                                     | 测试结果 |
| ---------------------- | ------------------------------------------------------------ | -------- |
| tmr_test               | 测试抗单粒子翻转功能能否正确执行                             | ☑️        |
| single_thread_tmr_test | 单线程下，分配内存后发生单粒子翻转后再读取数据，然后随机释放，重复10万次，发生单粒子翻转后是否能读取正确数据 | ☑️        |
| multi_thread_tmr_test  | 10个线程线程，分配内存后发生单粒子翻转后再读取数据，然后随机释放，重复10万次，发生单粒子翻转后是否能读取正确数据 | ☑️        |

##### 6. 日志功能测试

测试代码路径：/test/log_test.c

测试命令：make run_log_test

| 测试函数名             | 测试介绍                                                     | 测试结果 |
| ---------------------- | ------------------------------------------------------------ | -------- |
| single_thread_log_test | 单线程下分配随机大小内存块，连续分配1000次，分配后随机释放，是否能记录每次分配释放的相关信息 | ☑️        |
| multi_thread_logs_test | 10个线程，分配随机大小内存块，连续分配1000次，分配后随机释放，是否能记录每次分配释放的相关信息 | ☑️        |

日志信息介绍

```
THREAD ID:6347   /home/xiajiaheng/project788067-126918/test/log_test.c:14   malloc   start:0x0000600002015048   size:14383
THREAD ID:6347   /home/xiajiaheng/project788067-126918/test/log_test.c:12 (discriminator 2)   free     start:0x0000600002015048
```

日志信息包含内容有：线程ID（THREAD ID）、调用分配或释放函数所在的代码行、分配或释放的地址、调用分配函数时分配的大小

注：当被调用分配释放函数处于分支语句（for、if等）内时，代码行可能会定位在分支语句上
